<!DOCTYPE html>
<html lang="en" class="dark">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<script src="https://cdn.tailwindcss.com"></script>
		<title>URL Shortener Dashboard</title>
		<script>
			// Clear cookies & logout
			const clearCookies = () => {
				window.location.href = "/logout";
			};

			// Copy URL to clipboard
			const copyToClipboard = (url) => {
				const fullUrl = `${window.location.origin}/url/${url}`;
				navigator.clipboard.writeText(fullUrl).then(() => {
					const toast = document.createElement("div");
					toast.innerText = "âœ… Copied!";
					toast.className =
						"fixed bottom-6 right-6 bg-emerald-600 text-white px-4 py-2 rounded-lg shadow-lg animate-bounce";
					document.body.appendChild(toast);
					setTimeout(() => toast.remove(), 1500);
				});
			};
		</script>
	</head>

	<body
		class="bg-gradient-to-b from-gray-900 to-black text-gray-100 min-h-screen"
	>
		<!-- Navbar -->
		<nav
			class="bg-gray-900/80 backdrop-blur-md shadow border-b border-gray-800"
		>
			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
				<div class="flex justify-between h-16 items-center">
					<!-- Logo -->
					<h1
						class="text-emerald-400 text-2xl font-bold tracking-wide"
					>
						ðŸ”— URL Shortener
					</h1>

					<!-- Profile & Logout -->
					<div class="flex items-center space-x-4">
						<div class="flex items-center space-x-2">
							<div
								class="w-10 h-10 rounded-full bg-gray-800 border border-gray-700 flex items-center justify-center"
							>
								<svg
									class="w-6 h-6 text-gray-400"
									fill="currentColor"
									viewBox="0 0 20 20"
								>
									<path
										fill-rule="evenodd"
										d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
										clip-rule="evenodd"
									></path>
								</svg>
							</div>
							<span class="font-medium"
								><%= locals.userName %></span
							>
						</div>
						<button
							onclick="clearCookies()"
							class="bg-red-600 hover:bg-red-700 text-white px-4 py-1.5 rounded-lg text-sm shadow transition-transform hover:scale-105"
						>
							Logout
						</button>
					</div>
				</div>
			</div>
		</nav>

		<!-- Main Container -->
		<div class="max-w-5xl mx-auto py-10 px-4">
			<!-- URL Generator Card -->
			<div
				class="bg-gray-800/70 backdrop-blur-lg border border-gray-700 rounded-2xl shadow-xl p-6 mb-10 animate-fadeIn"
			>
				<h2
					class="text-2xl font-semibold text-emerald-400 mb-4"
				>
					Generate a Short URL
				</h2>
				<form
					method="POST"
					action="/url"
					class="flex flex-col sm:flex-row gap-4"
				>
					<input
						type="url"
						name="url"
						id="url"
						placeholder="Enter your long URL..."
						class="flex-1 px-4 py-2 rounded-lg border border-gray-700 bg-gray-900/80 text-white shadow-inner focus:ring-2 focus:ring-emerald-500 outline-none transition"
						required
					/>
					<button
						type="submit"
						class="bg-emerald-500 hover:bg-emerald-600 text-black font-semibold px-6 py-2 rounded-lg shadow-lg transition-transform hover:scale-105"
					>
						âš¡ Shorten
					</button>
				</form>

				<!-- Generated URL -->
				<% if (locals.id) { %>
				<div
					class="mt-5 flex justify-between items-center bg-emerald-500/20 border border-emerald-500 rounded-lg p-3"
				>
					<div>
						<p class="text-sm text-emerald-300">
							Short URL generated:
						</p>
						<a
							href="/url/<%= id %>"
							target="_blank"
							class="text-lg font-semibold hover:underline text-emerald-400"
						>
							<%= `${process.env.DOMAIN}/url/${id}` %>
						</a>
					</div>
					<button
						onclick="copyToClipboard('<%= id %>')"
						class="text-emerald-400 hover:text-emerald-300 text-lg"
					>
						ðŸ“‹
					</button>
				</div>
				<% } %>
			</div>

			<!-- Dashboard Table -->
			<% if (locals.urls && urls.length > 0) { %>
			<div
				class="bg-gray-800/70 backdrop-blur-lg border border-gray-700 rounded-2xl shadow-xl p-6 animate-fadeIn"
			>
				<h2
					class="text-2xl font-semibold text-blue-400 mb-4"
				>
					Your Shortened Links
				</h2>
				<div
					class="overflow-x-auto rounded-lg border border-gray-700"
				>
					<table
						class="min-w-full divide-y divide-gray-700"
					>
						<thead class="bg-gray-900">
							<tr>
								<th
									class="px-4 py-3 text-left text-sm font-medium text-gray-300"
								>
									#
								</th>
								<th
									class="px-4 py-3 text-left text-sm font-medium text-gray-300"
								>
									Short URL
								</th>
								<th
									class="px-4 py-3 text-left text-sm font-medium text-gray-300"
								>
									Destination
								</th>
								<th
									class="px-4 py-3 text-center text-sm font-medium text-gray-300"
								>
									Clicks
								</th>
							</tr>
						</thead>
						<tbody class="divide-y divide-gray-700">
							<% urls.forEach((url, index) => { %>
							<tr class="hover:bg-gray-700/50 transition">
								<td class="px-4 py-3 text-sm">
									<%= index + 1 %>
								</td>
								<td
									class="px-4 py-3 text-sm text-emerald-400"
								>
									<a
										href="/url/<%= url.shortId %>"
										class="hover:underline"
										><%= url.shortId %></a
									>
									<button
										onclick="copyToClipboard('<%= url.shortId %>')"
										class="ml-2 text-gray-400 hover:text-emerald-300"
									>
										ðŸ“‹
									</button>
								</td>
								<td
									class="px-4 py-3 text-sm text-gray-300 break-words max-w-md"
								>
									<%= url.redirectedUrl %>
								</td>
								<td
									class="px-4 py-3 text-sm text-center text-blue-400 font-semibold"
								>
									<%= url.visitHistory.length %>
								</td>
							</tr>
							<% }); %>
						</tbody>
					</table>
				</div>
			</div>
			<% } else { %>
			<p class="text-center mt-6 text-gray-400 italic">
				âœ¨ No URLs yet! Start by shortening one above.
			</p>
			<% } %>
		</div>

		<!-- Animation Styles -->
		<style>
			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(10px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}
			.animate-fadeIn {
				animation: fadeIn 0.5s ease-in-out;
			}
		</style>
	</body>
</html>
